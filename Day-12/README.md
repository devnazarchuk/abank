# День 12: Монетизація та плани підписки

**Дата:** [[2026-02-02]]
**Мета:** Інтегрувати платіжну систему та створити механізм платних підписок, які надають доступ до контенту.

---

## 1. Завдання на день

- [ ] **Вибір платіжної системи:**
  - [ ] Дослідити провайдерів, доступних в Україні (Stripe, Fondy, LiqPay).
  - [ ] **Рішення:** Stripe є світовим стандартом з чудовою документацією та API, тому варто почати з нього.
- [ ] **Проектування системи планів:**
  - [ ] **Моделі даних:**
    - `Plans`: `id`, `name` (напр., "Базовий", "Преміум"), `price`, `currency` (EUR), `stripe_price_id`.
    - `Subscriptions`: `id`, `user_id`, `plan_id`, `stripe_subscription_id`, `status` ('active', 'canceled'), `expires_at`.
  - [ ] Визначити, що саме обмежувати. Наприклад, безкоштовний доступ до перших 2-3 лекцій курсу, а далі — за підпискою.
- [ ] **Інтеграція з платіжною системою (Stripe):**
  - [ ] **Backend:**
    - Встановити Stripe SDK.
    - Створити ендпоінт `POST /api/subscriptions/create-checkout-session`, який створює сесію для оплати в Stripe і повертає URL для редиректу.
    - Створити вебхук `POST /api/stripe-webhook` для обробки подій від Stripe (напр., `checkout.session.completed`, `invoice.payment_succeeded`), щоб активувати підписку в базі даних.
  - [ ] **Frontend:**
    - Створити сторінку `/pricing` з описом планів та кнопками "Підписатися".
    - При кліку на кнопку, робити запит на бекенд для створення сесії і редиректити користувача на сторінку оплати Stripe.
- [ ] **Обмеження доступу до контенту:**
  - [ ] Модифікувати API та UI для перегляду лекцій.
  - [ ] Перед відображенням лекції перевіряти, чи є у користувача активна підписка (якщо лекція платна).
  - [ ] Якщо доступу немає, показувати пропозицію оформити підписку.

## 2. Результат дня

- Інтегрована платіжна система Stripe.
- Створено сторінку з планами, з якої користувач може перейти до оплати.
- Працює механізм обмеження доступу до контенту для користувачів без активної підписки.

## 3. Нотатки

- Інтеграція платежів — відповідальний етап. Важливо ретельно тестувати весь процес, особливо обробку вебхуків, оскільки від цього залежить, чи отримає користувач доступ після оплати.
- Stripe надає тестове середовище та тестові номери карток, які потрібно використовувати для розробки.
- Для MVP можна почати з одного платного плану (напр., 5 євро/місяць), як і обговорювалося.
- Потрібно створити сторінку для керування підпискою, де користувач може її скасувати (Stripe також надає для цього готовий портал).
